@using Po.LearnCert.Shared.Models

<RadzenRow Gap="1rem">
    @foreach (var card in GetStatCards())
    {
        <RadzenColumn Size="12" SizeSM="6" SizeMD="4" SizeLG="2">
            <RadzenCard class="rz-text-align-center">
                <RadzenStack Gap="0.5rem" AlignItems="AlignItems.Center">
                    <RadzenIcon Icon="@card.Icon" Style="@($"font-size: 2rem; color: {card.Color};")" />
                    <RadzenText TextStyle="TextStyle.H4" Text="@card.Value" Style="margin: 0;" />
                    <RadzenText TextStyle="TextStyle.Caption" class="rz-color-secondary" Text="@card.Label" />
                </RadzenStack>
            </RadzenCard>
        </RadzenColumn>
    }
</RadzenRow>

@code {
    [Parameter]
    public UserStatisticsDto Stats { get; set; } = default!;

    private IEnumerable<StatCard> GetStatCards() =>
    [
        new("assignment_turned_in", "var(--rz-primary)", Stats.TotalSessions.ToString(), "Sessions"),
        new("gps_fixed", "var(--rz-success)", $"{Stats.OverallAccuracy:F1}%", "Accuracy"),
        new("trending_up", "var(--rz-info)", $"{Stats.AverageScore:F1}%", "Avg Score"),
        new("emoji_events", "var(--rz-warning)", $"{Stats.BestScore:F1}%", "Best Score"),
        new("schedule", "var(--rz-secondary)", FormatStudyTime(Stats.TotalStudyTime), "Study Time"),
        new("help_outline", "var(--rz-text-color)", Stats.TotalQuestionsAnswered.ToString(), "Questions")
    ];

    private string FormatStudyTime(TimeSpan timeSpan) =>
        timeSpan.TotalHours >= 1 ? $"{timeSpan.Hours}h {timeSpan.Minutes}m" :
        timeSpan.TotalMinutes >= 1 ? $"{timeSpan.Minutes}m" : $"{timeSpan.Seconds}s";

    private record StatCard(string Icon, string Color, string Value, string Label);
}
