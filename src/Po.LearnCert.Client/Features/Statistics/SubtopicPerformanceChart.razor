@using Po.LearnCert.Shared.Models
@inject ILogger<SubtopicPerformanceChart> Logger

<div class="subtopic-performance-chart">
    <h3>Subtopic Performance</h3>
    
    @if (Performance == null || !Performance.Any())
    {
        <div class="no-data">
            <p>No subtopic performance data available yet.</p>
            <p class="hint">Complete some quiz sessions to see your performance breakdown by topic.</p>
        </div>
    }
    else
    {
        <div class="performance-grid">
            @foreach (var subtopic in Performance.OrderByDescending(p => p.Accuracy))
            {
                <div class="performance-item @GetPerformanceLevelClass(subtopic.PerformanceLevel)">
                    <div class="subtopic-header">
                        <h4>@subtopic.SubtopicName</h4>
                        <span class="cert-badge">@subtopic.CertificationId.ToUpper()</span>
                    </div>
                    
                    <div class="performance-stats">
                        <div class="stat">
                            <span class="stat-label">Accuracy</span>
                            <span class="stat-value">@subtopic.Accuracy.ToString("F1")%</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Attempts</span>
                            <span class="stat-value">@subtopic.QuestionsAnswered</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Correct</span>
                            <span class="stat-value">@subtopic.CorrectAnswers</span>
                        </div>
                    </div>
                    
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: @subtopic.Accuracy%"></div>
                    </div>
                    
                    <div class="performance-level">
                        <span class="level-badge @GetPerformanceLevelClass(subtopic.PerformanceLevel)">
                            @GetPerformanceLevelIcon(subtopic.PerformanceLevel) @subtopic.PerformanceLevel
                        </span>
                    </div>
                </div>
            }
        </div>
    }
</div>

@code {
    [Parameter]
    public List<SubtopicPerformanceDto>? Performance { get; set; }

    private string GetPerformanceLevelClass(PerformanceLevel level)
    {
        return level switch
        {
            PerformanceLevel.Excellent => "level-excellent",
            PerformanceLevel.Good => "level-strong",
            PerformanceLevel.Basic => "level-needs-practice",
            PerformanceLevel.NeedsImprovement => "level-weak",
            _ => "level-unknown"
        };
    }

    private string GetPerformanceLevelIcon(PerformanceLevel level)
    {
        return level switch
        {
            PerformanceLevel.Excellent => "üåü",
            PerformanceLevel.Good => "‚úÖ",
            PerformanceLevel.Basic => "‚ö†Ô∏è",
            PerformanceLevel.NeedsImprovement => "‚ùå",
            _ => "‚ùì"
        };
    }
}
